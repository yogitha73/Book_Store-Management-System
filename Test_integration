import json
import os
import tempfile
from app import app
from data_manager import DataManager

class TestIntegration(unittest.TestCase):
    """Integration tests for frontend-backend interaction"""
    
    def setUp(self):
        """Set up test fixtures before each test method"""
        # Create a temporary file for testing
        self.test_file = tempfile.NamedTemporaryFile(mode='w', suffix='.json', delete=False)
        # Initialize with valid JSON structure
        initial_data = {
            'books': [],
            'next_id': 1,
            'last_updated': '2023-01-01T00:00:00.000000'
        }
json.dump(initial_data, self.test_file, indent=2)
        self.test_file.close()
        
        # Configure app for testing
        app.config['TESTING'] = True
        app.config['WTF_CSRF_ENABLED'] = False
        
        # Replace the data manager with test version
        import app as app_module
        app_module.data_manager = DataManager(self.test_file.name)
        
        # Create test client
        self.client = app.test_client()
        
        # Sample book data for testing
        self.sample_book = {
            'title': 'Integration Test Book',
            'author': 'Test Author',
            'isbn': '978-0-123456-78-9',
            'price': 29.99,
            'quantity': 10,
            'genre': 'Fiction',
            'description': 'A test book for integration testing'
        }
    
    def tearDown(self):
        """Clean up after each test method"""
        # Remove the temporary test file
        try:
            os.unlink(self.test_file.name)
        except FileNotFoundError:
            pass
    
    def test_frontend_backend_interaction(self):
        """Test complete frontend-backend interaction flow"""
        
